<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Register</title>
    <link rel="stylesheet" href="../css/main.css">

    <script>
        window.$ = window.jQuery = require("jquery")
    </script>
</head>
<body>

<div id="content"> Se le sacará una foto para registrarse</div>

<script type="text/javascript">

    const socket = require("./../../sockets/socket.js")

    let message = ""

    function showResponse() {

        let content = $("#content")

        if (message === "No faces detected") {
            content.text("Se encuentra muy lejos, por favor acerquese")
        }else{
            let splitMessage = message.split(" ")
            if(splitMessage[0] === "Known")
                content.text("Bienvenido " + splitMessage[splitMessage.length - 1])
            if(splitMessage[0] === "Unknown")
                content.text("Se ha registrado exitosamente como " + splitMessage[splitMessage.length - 1])
        }
    }

    // Countdown
    let count = 3

    function updateTimer() {
        let content = $("#content")

        if (count > 0) {

            content.fadeOut("slow", function () {
                content.text(count)
                content.fadeIn()
                count--
            })
        }
        else if (count === 0) {
            content.fadeOut("slow", function () {
                content.text("¡Foto!")
                content.fadeIn()

                socket.send("Capture", (data) => {
                    message = String(data)
                })

                count--
            })
        }
        else {
            content.fadeOut("slow", function () {
                content.text("")
                showResponse()
                content.fadeIn()
                clearInterval(interval)
            })
        }
    }

    let interval = setInterval(function () {
        updateTimer()
    }, 1000)

</script>

</body>
</html>